<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>코크니짐 체력측정</title>
  <!-- Pretendard 폰트 -->
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap" rel="stylesheet">
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: 'Pretendard', sans-serif; background: #E0F2FE; }
    .title-gradient { @apply text-3xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-teal-400; }
    .glass-card { background: rgba(255,255,255,0.6); backdrop-filter: blur(12px); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border:1px solid rgba(255,255,255,0.5); border-radius:1rem; }
    .btn-primary { @apply bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transition; }
    .btn-secondary { @apply bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transition; }
    table { @apply w-full border-collapse text-sm; }
    th, td { @apply border p-2; }
    th { @apply bg-gray-100 text-gray-700 font-medium; }
    td { @apply bg-white; }
  </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">
  <!-- 입력 폼 섹션 -->
  <div id="inputSection" class="w-full max-w-md bg-white p-6 rounded-xl shadow-xl">
    <h1 class="title-gradient mb-6">코크니짐 체력측정 입력</h1>
    <div class="space-y-4">
      <input id="f_name" type="text" placeholder="이름" class="w-full border rounded p-3 focus:outline-none" />
      <select id="f_gender" class="w-full border rounded p-3 focus:outline-none">
        <option>남성</option>
        <option>여성</option>
      </select>
      <input id="f_birth" type="date" class="w-full border rounded p-3 focus:outline-none" />
      <input id="f_height" type="number" step="0.01" placeholder="신장 (cm)" class="w-full border rounded p-3 focus:outline-none" />
      <input id="f_weight" type="number" step="0.01" placeholder="체중 (kg)" class="w-full border rounded p-3 focus:outline-none" />
      <input id="f_measureDate" type="date" class="w-full border rounded p-3 focus:outline-none" />
      <div id="f_tests" class="space-y-4"></div>
      <button id="toResult" class="btn-primary w-full">결과 보기</button>
    </div>
  </div>  <!-- 결과 섹션 -->  <div id="resultSection" class="hidden w-full max-w-2xl space-y-8 mt-8">
    <h1 class="title-gradient">코크니짐 체력측정 결과지</h1><!-- 기본 정보 카드 -->
<div class="glass-card p-6">
  <h2 class="text-xl font-bold text-indigo-700 mb-4">기본 정보</h2>
  <table>
    <tbody>
      <tr><th>이름</th><td id="nameCell"></td></tr>
      <tr><th>성별</th><td id="genderCell"></td></tr>
      <tr><th>생년월일</th><td id="birthCell"></td></tr>
      <tr><th>측정일</th><td id="measureDateCell"></td></tr>
    </tbody>
  </table>
</div>

<!-- 신체 정보 카드 + BMI -->
<div class="glass-card p-6">
  <h2 class="text-xl font-bold text-indigo-700 mb-4">신체조성 평가</h2>
  <table>
    <tbody>
      <tr><th>신장 (cm)</th><td id="heightCell"></td></tr>
      <tr><th>체중 (kg)</th><td id="weightCell"></td></tr>
    </tbody>
  </table>
  <h3 class="text-md font-semibold text-indigo-600 mt-6 mb-2">BMI 평가</h3>
  <div class="score-bar">
    <div class="score-seg bg-blue-500" style="left:0;width:25%;">저체중</div>
    <div class="score-seg bg-green-500" style="left:25%;width:20%;">정상</div>
    <div class="score-seg bg-yellow-500" style="left:45%;width:20%;">과체중</div>
    <div class="score-seg bg-red-500" style="left:65%;width:35%;border-top-right-radius:9999px;border-bottom-right-radius:9999px;">비만</div>
    <span class="threshold-label" style="left:25%;">18.5</span>
    <span class="threshold-label" style="left:45%;">23</span>
    <span class="threshold-label" style="left:65%;">25</span>
    <div id="bmiMarkerLine" class="marker-line"></div>
    <div id="bmiMarkerArrow" class="marker-arrow"></div>
    <span id="bmiMarkerValue" class="marker-value"></span>
  </div>
</div>

<!-- 레이더 차트 -->
<div class="glass-card p-6">
  <h2 class="text-xl font-bold text-indigo-700 mb-4">체력 측정 종합</h2>
  <canvas id="radarChart" height="300"></canvas>
</div>

<!-- 항목별 세부 평가 카드 -->
<div id="detailCards" class="space-y-6"></div>

<!-- 버튼 영역 -->
<div class="flex justify-center space-x-4">
  <button onclick="openReferenceModal()" class="btn-primary">참고 기준 보기</button>
  <button onclick="downloadPDF()" class="btn-secondary">PDF 저장하기</button>
</div>

<!-- 상담문의 -->
<div class="text-center text-sm text-gray-600">
  상담문의 : 010-5380-5840<br>
  <a href="https://linktr.ee/Kokenigym" target="_blank" class="text-blue-600 underline">코크니짐 Linktree 바로가기</a>
</div>

  </div>  <!-- 방법 모달 -->  <div id="methodModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-xl">
      <h3 id="methodTitle" class="text-lg font-bold text-indigo-700 mb-4 text-center"></h3>
      <p id="methodDesc" class="text-sm text-gray-700 mb-6 text-center"></p>
      <div class="text-center">
        <button onclick="closeMethodModal()" class="btn-primary">닫기</button>
      </div>
    </div>
  </div>  <!-- 참고 기준 모달 -->  <div id="referenceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-2xl w-full shadow-xl">
      <h3 class="text-lg font-bold text-indigo-700 mb-6 text-center">참고 기준표</h3>
      <div class="flex justify-center mb-6 space-x-2">
        <button onclick="showYouthStandard()" class="tab-button active-tab">5~11세</button>
        <button onclick="showPAPSStandard()" class="tab-button">12세 이상</button>
      </div>
      <div id="youthStandard" class="overflow-x-auto mb-4">
        <!-- youth table -->
      </div>
      <div id="papsStandard" class="hidden overflow-x-auto mb-4">
        <!-- paps table -->
      </div>
      <div class="text-center">
        <button onclick="closeReferenceModal()" class="btn-primary">닫기</button>
      </div>
    </div>
  </div>
  <script>
    // 초기값 & 테스트 항목 생성
    const tests = ['유연성','근력','순발력','민첩성','평형성','협응성'];
    const f_tests = document.getElementById('f_tests');
    tests.forEach((t,i)=>{
      f_tests.insertAdjacentHTML('beforeend',`
        <div class="space-y-1">
          <div class="font-medium">${t}</div>
          <input id="f_t${i}1" type="number" placeholder="1회 측정값" class="w-full border p-2 rounded"/>
          <input id="f_t${i}2" type="number" placeholder="2회 측정값 (선택)" class="w-full border p-2 rounded"/>
        </div>`);
    });

    // 파라미터 파싱
    function getParams(){
      const p = new URLSearchParams(location.search);
      const d = {
        name:p.get('name')||'',
        gender:p.get('gender')||'',
        birth:p.get('birth')||'',
        height:+p.get('height')||0,
        weight:+p.get('weight')||0,
        measureDate:p.get('measureDate')||''
      };
      tests.forEach((_,i)=>{
        d[`t${i}1`]=+p.get(`t${i}1`)||0;
        d[`t${i}2`]=+p.get(`t${i}2`)||0;
      });
      return d;
    }

    // DOM Ready
    document.addEventListener('DOMContentLoaded',()=>{
      const data = getParams();
      if(data.name){
        // 결과
        document.getElementById('inputSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');
        renderBasicInfo(data);
        renderBodyInfo(data);
        renderRadarChart(data);
        renderDetailCards(data);
      } else {
        // 폼: 측정일 오늘 자동
        document.getElementById('f_measureDate').value = new Date().toISOString().split('T')[0];
      }
    });

    // 결과 보기 버튼
    document.getElementById('toResult').addEventListener('click',()=>{
      const p = new URLSearchParams();
      p.set('name', document.getElementById('f_name').value);
      p.set('gender', document.getElementById('f_gender').value);
      p.set('birth', document.getElementById('f_birth').value);
      p.set('height', document.getElementById('f_height').value);
      p.set('weight', document.getElementById('f_weight').value);
      p.set('measureDate', document.getElementById('f_measureDate').value);
      tests.forEach((_,i)=>{
        p.set(`t${i}1`, document.getElementById(`f_t${i}1`).value);
        p.set(`t${i}2`, document.getElementById(`f_t${i}2`).value);
      });
      location.search = p.toString();
    });

    // 렌더링 함수들 (기존 예제 기반, index.html 포맷 준수)
    function renderBasicInfo(d){
      document.getElementById('basicInfoCard').innerHTML=`
        <h2 class="text-lg font-bold text-indigo-700 mb-4">기본 정보</h2>
        <table><tbody>
          <tr><th>이름</th><td>${d.name}</td></tr>
          <tr><th>성별</th><td>${d.gender}</td></tr>
          <tr><th>생년월일</th><td>${d.birth} (만 ${calcAge(d)}세)</td></tr>
          <tr><th>측정일</th><td>${d.measureDate}</td></tr>
        </tbody></table>`;
    }
    function calcAge(d){
      const b=new Date(d.birth), m=new Date(d.measureDate);
      let age=m.getFullYear()-b.getFullYear(), mm=m.getMonth()-b.getMonth();
      if(mm<0||(mm===0&&m.getDate()<b.getDate())) age--;
      return age;
    }
    function renderBodyInfo(d){
      document.getElementById('bodyInfoCard').innerHTML=`
        <h2 class="text-lg font-bold text-indigo-700 mb-4">신체조성 평가</h2>
        <table><tbody>
          <tr><th>신장(cm)</th><td>${d.height}</td></tr>
          <tr><th>체중(kg)</th><td>${d.weight}</td></tr>
        </tbody></table>
        <h3 class="text-md font-semibold text-indigo-600 mt-6 mb-2">BMI 평가</h3>
        <div class="score-bar">
          <div class="score-seg bg-blue-400" style="left:0; width:25%;">저체중</div>
          <div class="score-seg bg-green-400" style="left:25%; width:20%;">정상</div>
          <div class="score-seg bg-yellow-400" style="left:45%; width:20%;">과체중</div>
          <div class="score-seg bg-orange-400" style="left:65%; width:35%; border-radius:9999px;">비만</div>
          <span class="threshold-label" style="left:25%;">18.5</span>
          <span class="threshold-label" style="left:45%;">23</span>
          <span class="threshold-label" style="left:65%;">25</span>
          <div id="bmiMarkerLine" class="marker-line"></div>
          <div id="bmiMarkerArrow" class="marker-arrow"></div>
          <span id="bmiMarkerValue" class="marker-value"></span>
        </div>`;
      const bmi=(d.weight/((d.height/100)**2)).toFixed(1);
      let pos=0;
      if(bmi<18.5) pos=(bmi/18.5)*25;
      else if(bmi<23) pos=25+((bmi-18.5)/4.5)*20;
      else if(bmi<25) pos=45+((bmi-23)/2)*20;
      else pos=65+((bmi-25)/5)*35;
      document.getElementById('bmiMarkerLine').style.left=`${pos}%`;
      document.getElementById('bmiMarkerArrow').style.left=`${pos}%`;
      document.getElementById('bmiMarkerValue').style.left=`${pos}%`;
      document.getElementById('bmiMarkerValue').innerText=bmi;
    }
    function renderRadarChart(d){
      const ctx=document.getElementById('radarChart').getContext('2d');
      new Chart(ctx,{type:'radar',
        data:{labels:tests,datasets:[
          {label:'1회 측정',data:tests.map((_,i)=>d[`t${i}1`]),
           backgroundColor:'rgba(59,130,246,0.2)',borderColor:'rgba(59,130,246,1)'},
          {label:'2회 측정',data:tests.map((_,i)=>d[`t${i}2`]),
           backgroundColor:'rgba(16,185,129,0.2)',borderColor:'rgba(16,185,129,1)'}
        ]},
        options:{responsive:true,plugins:{legend:{position:'top'}},scales:{r:{suggestedMin:0,suggestedMax:100}}}
      });
    }
    function renderDetailCards(d){
      const ct=document.getElementById('detailCards'); ct.innerHTML='';
      tests.forEach((label,i)=>{
        const v1=d[`t${i}1`], v2=d[`t${i}2`];
        const grade=getGrade(label,v1), color=getGradeColor(grade), pct=gradeToPercent(grade);
        const fixed=getFixedDesc(label), comment=getComment(label,grade);
        const method=getMethod(label);
        ct.insertAdjacentHTML('beforeend',`
<div class="p-4 bg-white rounded-lg shadow mb-4 cursor-pointer" onclick="toggleCard('card${i}')">
  <div class="flex flex-col space-y-2">
    <h3 class="text-lg font-bold">${label}</h3>
    <div class="relative w-full h-4 bg-gray-200 rounded-full overflow-hidden">
      <div class="absolute top-0 left-0 ${color}" style="width:${pct}%;"></div>
      <span class="absolute inset-0 text-center text-xs font-bold text-white leading-4">${v1}</span>
    </div>
  </div>
</div>
<div id="card${i}" class="max-h-0 overflow-hidden transition-all duration-300 ease-in-out">
  <table class="w-full text-xs table-auto border">
    <thead class="bg-gray-100 text-gray-700">
      <tr><th class="p-2 border">항목</th><th class="p-2 border">값</th></tr>
    </thead>
    <tbody>
      <tr><th class="p-2 border">측정 방법</th>
          <td class="p-2 border">
            <button onclick="openMethodModal(event,'${method.title}','${method.desc}')"
                    class="text-blue-600 underline text-xs">${method.title}</button>
          </td></tr>
      <tr><th class="p-2 border">1회 측정값</th><td class="p-2 border">${v1}</td></tr>
      ${v2?`<tr><th class="p-2 border">2회 측정값</th><td class="p-2 border">${v2}</td></tr>`:''}
    </tbody>
  </table>
  <p class="text-xs text-gray-700 mt-2 px-2">${fixed}</p>
  <p class="text-xs font-semibold mt-1 px-2">${comment}</p>
</div>`);
      });
    }
    function toggleCard(id){
      const e=document.getElementById(id);
      e.classList.toggle('max-h-0'); e.classList.toggle('max-h-[1000px]');
    }
    function getMethod(label){
      const m={
        '유연성':{title:'좌전굴 (Sit and Reach)',desc:'앉아서 상체를...'},
        '근력':{title:'윗몸일으키기',desc:'1분간...'}, 
        '순발력':{title:'제자리멀리뛰기',desc:'제자리에서...'},
        '민첩성':{title:'왕복달리기',desc:'거리 반복...'},
        '평형성':{title:'한발서기',desc:'한발로 버티기...'},
        '협응성':{title:'공잡기',desc:'공 잡기...'}
      };
      return m[label]||{title:label,desc:''};
    }
    function openMethodModal(evt,title,desc){
      evt.stopPropagation();
      document.getElementById('methodTitle').innerText=title;
      document.getElementById('methodDesc').innerText=desc;
      document.getElementById('methodModal').classList.remove('hidden');
    }
    function closeMethodModal(){
      document.getElementById('methodModal').classList.add('hidden');
    }
    function openReferenceModal(){
      document.getElementById('referenceModal').classList.remove('hidden');
    }
    function closeReferenceModal(){
      document.getElementById('referenceModal').classList.add('hidden');
    }
    function showYouthStandard(){
      document.getElementById('youthStandard').classList.remove('hidden');
      document.getElementById('papsStandard').classList.add('hidden');
      event.target.classList.add('active-tab');
      event.target.parentNode.querySelector('.active-tab:not(:focus)').classList.remove('active-tab');
    }
    function showPAPSStandard(){
      document.getElementById('papsStandard').classList.remove('hidden');
      document.getElementById('youthStandard').classList.add('hidden');
      event.target.classList.add('active-tab');
      event.target.parentNode.querySelector('.active-tab:not(:focus)').classList.remove('active-tab');
    }
    function getGrade(label,v){
      if(isNaN(v))return 4;
      if(label==='유연성')return v>=13?1:v>=10?2:v>=5?3:4;
      if(label==='근력')return v>=60?1:v>=40?2:v>=20?3:4;
      if(label==='순발력')return v>=140?1:v>=120?2:v>=100?3:4;
      if(label==='민첩성')return v<=4.5?1:v<=5.5?2:v<=6.5?3:4;
      if(label==='평형성')return v>=60?1:v>=40?2:v>=20?3:4;
      if(label==='협응성')return v>=3?1:v==2?2:v==1?3:4;
      return 4;
    }
    function getGradeColor(g){
      return g===1?'bg-blue-400':g===2?'bg-green-400':g===3?'bg-yellow-400':'bg-orange-400';
    }
    function gradeToPercent(g){
      return g===1?95:g===2?80:g===3?65:45;
    }
    function getFixedDesc(l){
      const d={'유연성':'유연성은 부상 예방과…','근력':'근력은…',
               '순발력':'순발력은…','민첩성':'민첩성은…',
               '평형성':'평형성은…','협응성':'협응성은…'};
      return d[l]||'';
    }
    function getComment(l,g){
      return g===1?'매우 우수합니다':g===2?'우수합니다':g===3?'보통 수준입니다':'노력이 필요합니다';
    }
    function downloadPDF(){
      html2pdf().from(document.body).set({
        margin:0.5,
        filename:`result_${new Date().toISOString().slice(0,10)}.pdf`,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2},
        jsPDF:{unit:'in',format:'a4',orientation:'portrait'}
      }).save();
    }
  </script>
</body>
</html>

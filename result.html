<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>코크니짐 체력측정 결과지</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    body { font-family: 'Pretendard', sans-serif; background: #E0F2FE; padding: 1rem; }
    .glass-card { background: rgba(255,255,255,0.6); backdrop-filter: blur(12px); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.5); max-width: 700px; margin: auto; padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 0.5rem; table-layout: fixed; }
    th, td { padding: 0.5rem; text-align: left; font-size: 0.875rem; word-break: keep-all; }
    th { background: #EFF6FF; color: #1E40AF; width: 40%; }
    td { background: #FFFFFF; width: 60%; }
    .score-bar { position: relative; width: 100%; height: 2rem; background: #f3f4f6; border-radius: 9999px; overflow: visible; margin-top: 1.5rem; }
    .marker-line { position: absolute; bottom: 0; height: 100%; width: 2px; background: #1f1f1f; transform: translateX(-50%); }
    .marker-arrow { position: absolute; bottom: -0.5rem; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 7px solid #1f1f1f; transform: translateX(-50%); }
    .marker-value { position: absolute; bottom: -2rem; font-size: 0.875rem; font-weight: 700; transform: translateX(-50%); color: #1f1f1f; }
    .title-gradient { background: linear-gradient(90deg, #3b82f6, #10b981); -webkit-background-clip: text; color: transparent; }
  </style>
</head>
<body>

<h1 class="text-3xl font-extrabold text-center title-gradient mb-8">코크니짐 체력측정 결과지</h1><div class="glass-card text-left">
  <h2 class="text-lg font-bold text-indigo-700 mb-4">기본 정보</h2>
  <table>
    <tbody>
      <tr><th>이름</th><td id="nameField"></td></tr>
      <tr><th>성별</th><td id="genderField"></td></tr>
      <tr><th>생년월일</th><td><span id="birthField"></span> <span id="ageDisplay" class="text-gray-500"></span></td></tr>
      <tr><th>측정일</th><td id="measureDateField"></td></tr>
    </tbody>
  </table>
</div>

<div class="glass-card text-left">
  <h2 class="text-lg font-bold text-indigo-700 mb-4">신체조성 평가</h2>
  <table>
    <tbody>
      <tr><th>신장(cm)</th><td id="heightField"></td></tr>
      <tr><th>체중(kg)</th><td id="weightField"></td></tr>
    </tbody>
  </table>

  <h3 class="text-md font-semibold text-indigo-600 mt-6 mb-2">BMI 평가</h3>
  <div class="score-bar">
    <div id="bmiMarkerLine" class="marker-line"></div>
    <div id="bmiMarkerArrow" class="marker-arrow"></div>
    <span id="bmiMarkerValue" class="marker-value"></span>
  </div>
</div>

<div class="glass-card">
  <h2 class="text-lg font-bold text-indigo-700 mb-4 text-left">체력 측정 종합</h2>
  <canvas id="radarChart" width="300" height="300"></canvas>
</div>

<div id="detailCards" class="space-y-6"></div><script>
// URL에서 formData 읽기
function getFormDataFromURL() {
  const params = new URLSearchParams(window.location.search);
  const data = {};
  for (const [key, value] of params.entries()) {
    data[key] = isNaN(value) ? value : parseFloat(value);
  }
  return data;
}

const formData = getFormDataFromURL();

// 기본 정보 채우기
function fillBasicInfo() {
  document.getElementById("nameField").innerText = formData.name || '-';
  document.getElementById("genderField").innerText = formData.gender || '-';
  document.getElementById("birthField").innerText = formData.birth || '-';
  document.getElementById("measureDateField").innerText = formData.measureDate || '-';

  if (formData.birth && formData.measureDate) {
    const birthDate = new Date(formData.birth);
    const measureDate = new Date(formData.measureDate);
    let age = measureDate.getFullYear() - birthDate.getFullYear();
    const m = measureDate.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && measureDate.getDate() < birthDate.getDate())) {
      age--;
    }
    document.getElementById("ageDisplay").innerText = `(만 ${age}세)`;
  }
}

// 신체 정보 채우기
function fillBodyInfo() {
  document.getElementById("heightField").innerText = formData.height || '-';
  document.getElementById("weightField").innerText = formData.weight || '-';
}

// BMI 계산 및 마커 이동
function drawBMI() {
  if (!formData.height || !formData.weight) return;
  const heightM = formData.height / 100;
  const bmi = (formData.weight / (heightM * heightM)).toFixed(1);
  let bmiPercent = 0;
  if (bmi < 18.5) bmiPercent = (bmi / 18.5) * 25;
  else if (bmi < 23) bmiPercent = 25 + ((bmi - 18.5) / (23 - 18.5)) * 20;
  else if (bmi < 25) bmiPercent = 45 + ((bmi - 23) / (25 - 23)) * 20;
  else bmiPercent = 65 + ((bmi - 25) / 10) * 35;
  bmiPercent = Math.min(bmiPercent, 100);

  document.getElementById("bmiMarkerLine").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerArrow").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerValue").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerValue").innerText = bmi;
}

// 레이더 차트 그리기
function drawRadar() {
  const ctx = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['유연성', '근력', '순발력', '민첩성', '평형성', '협응성'],
      datasets: [{
        label: '1회 측정',
        data: [formData.t01, formData.t11, formData.t21, formData.t31, formData.t41, formData.t51],
        fill: true,
        backgroundColor: 'rgba(59, 130, 246, 0.2)',
        borderColor: 'rgba(59, 130, 246, 1)',
        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
      },{
        label: '2회 측정',
        data: [formData.t02, formData.t12, formData.t22, formData.t32, formData.t42, formData.t52],
        fill: true,
        backgroundColor: 'rgba(16, 185, 129, 0.2)',
        borderColor: 'rgba(16, 185, 129, 1)',
        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' }},
      scales: { r: { suggestedMin: 0, suggestedMax: 100 }}
    }
  });
}
</script><script>
// 세부 평가 카드 자동 생성
function fillDetailCards() {
  const items = [
    { label: '유연성', key: 't0', unit: 'cm', method: '좌전굴 (Sit and Reach Test)', description: '허리와 다리 뒤쪽 근육의 유연성을 평가하는 방법입니다.' },
    { label: '근력', key: 't1', unit: '초', method: '윗몸 일으키기 (Sit-up Test)', description: '복근과 전신 근지구력을 평가하는 방법입니다.' },
    { label: '순발력', key: 't2', unit: 'cm', method: '제자리멀리뛰기 (Standing Long Jump)', description: '짧은 시간에 최대 힘을 발휘하는 순발력을 평가합니다.' },
    { label: '민첩성', key: 't3', unit: '초', method: '장애물 왕복달리기 (Shuttle Run)', description: '빠른 방향 전환과 민첩성을 평가합니다.' },
    { label: '평형성', key: 't4', unit: '초', method: '한발서기 (One-leg Stand)', description: '신체 균형 능력을 평가합니다.' },
    { label: '협응성', key: 't5', unit: '회', method: '공잡기 (Ball Catching)', description: '손과 눈의 협응 능력을 평가합니다.' }
  ];

  const container = document.getElementById('detailCards');
  container.innerHTML = '';

  items.forEach((item, i) => {
    const v1 = formData[`${item.key}1`] || '-';
    const v2 = formData[`${item.key}2`] || '-';
    
    const card = document.createElement('div');
    card.className = 'glass-card text-left';
    card.innerHTML = `
      <h2 class="text-lg font-bold text-indigo-700 mb-4">${item.label}</h2>
      <table>
        <tbody>
          <tr><th>측정 방법</th><td>${item.method}</td></tr>
          <tr><th>1회 측정값</th><td>${v1} ${item.unit}</td></tr>
          <tr><th>2회 측정값</th><td>${v2} ${item.unit}</td></tr>
        </tbody>
      </table>
      <p class="text-sm text-gray-700 mt-2">${item.description}</p>
    `;
    container.appendChild(card);
  });
}

// 페이지 로드 시 자동 실행
document.addEventListener("DOMContentLoaded", function() {
  fillBasicInfo();
  fillBodyInfo();
  drawBMI();
  drawRadar();
  fillDetailCards();
});
</script>
<div class="text-center text-xs text-gray-500 mt-10 mb-4">
  상담문의 : 010-5380-5840<br>
  <a href="https://linktr.ee/Kokenigym" target="_blank" class="underline text-blue-600">
    코크니짐 Linktree 바로가기
  </a>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>코크니짐 체력측정 결과지</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: 'Pretendard', sans-serif; background: #E0F2FE; padding: 1rem; }
    .glass-card { background: rgba(255,255,255,0.6); backdrop-filter: blur(12px); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.5); max-width: 600px; margin: auto; padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 0.5rem; table-layout: fixed; }
    th, td { padding: 0.5rem; text-align: left; font-size: 0.875rem; word-break: keep-all; }
    th { background: #EFF6FF; color: #1E40AF; width: 40%; }
    td { background: #FFFFFF; width: 60%; }
    .score-bar { position: relative; width: 100%; height: 2rem; background: #f3f4f6; border-radius: 9999px; overflow: visible; margin-top: 1.5rem; }
    .marker-line { position: absolute; bottom: 0; height: 100%; width: 2px; background: #1f1f1f; transform: translateX(-50%); }
    .marker-arrow { position: absolute; bottom: -0.5rem; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 7px solid #1f1f1f; transform: translateX(-50%); }
    .marker-value { position: absolute; bottom: -2rem; font-size: 0.875rem; font-weight: 700; transform: translateX(-50%); color: #1f1f1f; }
    .title-gradient { background: linear-gradient(90deg, #3b82f6, #10b981); -webkit-background-clip: text; color: transparent; }
  </style>
</head>

<body>

<h1 class="text-3xl font-extrabold text-center title-gradient mb-8">코크니짐 체력측정 결과지</h1>

<div class="glass-card text-left">
  <h2 class="text-lg font-bold text-indigo-700 mb-4">기본 정보</h2>
  <table>
    <tbody>
      <tr><th>이름</th><td id="nameField"></td></tr>
      <tr><th>성별</th><td id="genderField"></td></tr>
      <tr><th>생년월일</th><td><span id="birthField"></span> <span id="ageDisplay" class="text-gray-500"></span></td></tr>
      <tr><th>측정일</th><td id="measureDateField"></td></tr>
    </tbody>
  </table>
</div>

<div class="glass-card text-left">
  <h2 class="text-lg font-bold text-indigo-700 mb-4">신체조성 평가</h2>
  <table>
    <tbody>
      <tr><th>신장(cm)</th><td id="heightField"></td></tr>
      <tr><th>체중(kg)</th><td id="weightField"></td></tr>
    </tbody>
  </table>

  <h3 class="text-md font-semibold text-indigo-600 mt-6 mb-2">BMI 평가</h3>
  <div class="score-bar">
    <div id="bmiMarkerLine" class="marker-line"></div>
    <div id="bmiMarkerArrow" class="marker-arrow"></div>
    <span id="bmiMarkerValue" class="marker-value"></span>
  </div>
</div>

<div class="glass-card">
  <h2 class="text-lg font-bold text-indigo-700 mb-4 text-left">체력 측정 종합</h2>
  <canvas id="radarChart" width="300" height="300"></canvas>
</div>

<div id="detailCards" class="space-y-6"></div>

<script>
// URL에서 formData 가져오기
function getFormDataFromURL() {
  const params = new URLSearchParams(window.location.search);
  const data = {};

  for (const [key, value] of params.entries()) {
    data[key] = isNaN(value) ? value : parseFloat(value);
  }
  return data;
}

const formData = getFormDataFromURL();

function calculateAge(birth, measure) {
  const birthDate = new Date(birth);
  const measureDate = new Date(measure);
  let age = measureDate.getFullYear() - birthDate.getFullYear();
  const m = measureDate.getMonth() - birthDate.getMonth();
  if (m < 0 || (m === 0 && measureDate.getDate() < birthDate.getDate())) {
    age--;
  }
  return age;
}

function fillBasicInfo() {
  document.getElementById("nameField").innerText = formData.name;
  document.getElementById("genderField").innerText = formData.gender;
  document.getElementById("birthField").innerText = formData.birth;
  document.getElementById("measureDateField").innerText = formData.measureDate;
  document.getElementById("ageDisplay").innerText = "(만 " + calculateAge(formData.birth, formData.measureDate) + "세)";
}

function fillBodyInfo() {
  document.getElementById("heightField").innerText = formData.height;
  document.getElementById("weightField").innerText = formData.weight;
  drawBMI();
}

function drawBMI() {
  const heightM = formData.height / 100;
  const bmi = (formData.weight / (heightM * heightM)).toFixed(1);
  let bmiPercent = 0;
  if (bmi < 18.5) bmiPercent = (bmi / 18.5) * 25;
  else if (bmi < 23) bmiPercent = 25 + ((bmi - 18.5) / (23 - 18.5)) * 20;
  else if (bmi < 25) bmiPercent = 45 + ((bmi - 23) / (25 - 23)) * 20;
  else bmiPercent = 65 + ((bmi - 25) / 10) * 35;
  bmiPercent = Math.min(bmiPercent, 100);

  document.getElementById("bmiMarkerLine").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerArrow").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerValue").style.left = bmiPercent + "%";
  document.getElementById("bmiMarkerValue").innerText = bmi;
}

function drawRadar() {
  const ctx = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['유연성', '근력', '순발력', '민첩성', '평형성', '협응성'],
      datasets: [{
        label: '1회 측정',
        data: [formData.t01, formData.t11, formData.t21, formData.t31, formData.t41, formData.t51],
        fill: true,
        backgroundColor: 'rgba(59, 130, 246, 0.2)',
        borderColor: 'rgba(59, 130, 246, 1)',
        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
      },{
        label: '2회 측정',
        data: [formData.t02, formData.t12, formData.t22, formData.t32, formData.t42, formData.t52],
        fill: true,
        backgroundColor: 'rgba(16, 185, 129, 0.2)',
        borderColor: 'rgba(16, 185, 129, 1)',
        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' }},
      scales: { r: { suggestedMin: 0, suggestedMax: 100 }}
    }
  });
}

// 시작할 때
document.addEventListener("DOMContentLoaded", function() {
  fillBasicInfo();
  fillBodyInfo();
  drawRadar();
  // 세부 카드 생략 버전 (간단 출력만) 추가 가능
});
</script>

</body>
</html>
